[tools]
rust = "1.91.1"
node = "24.12.0"
"cargo:tauri-cli" = "2.9.4"
"cargo:cargo-llvm-cov" = "0.6.15"

[tasks.dev]
description = "Run Tauri app in development mode"
run = "cargo tauri dev"

[tasks.build]
description = "Build Tauri app for production"
run = "cargo tauri build"

[tasks.lint]
description = "Run all linters"
depends = ["lint:rust", "lint:frontend"]

[tasks."lint:rust"]
description = "Run Rust linter (clippy)"
run = "cargo clippy --all-targets --all-features --manifest-path src-tauri/Cargo.toml -- -D warnings"

[tasks."lint:frontend"]
description = "Run frontend linter (oxlint)"
run = "npm run lint"

[tasks.fmt]
description = "Format all code"
depends = ["fmt:rust", "fmt:frontend"]

[tasks."fmt:rust"]
description = "Format Rust code"
run = "cargo fmt --all --manifest-path src-tauri/Cargo.toml"

[tasks."fmt:frontend"]
description = "Format frontend code"
run = "npm run format"

[tasks.test]
description = "Run all tests"
depends = ["test:rust", "test:frontend"]

[tasks."test:rust"]
description = "Run Rust tests"
run = "cargo test --manifest-path src-tauri/Cargo.toml -- --test-threads=1"

[tasks."test:frontend"]
description = "Run frontend tests"
run = "npm run test"

[tasks.check]
description = "Run all checks (fmt, lint, test)"
depends = ["fmt", "lint", "test"]

[tasks.clean]
description = "Clean build artifacts"
run = "cargo clean && rm -rf node_modules dist"

[tasks.install]
description = "Install frontend dependencies"
run = "npm install"

[tasks.coverage]
description = "Generate coverage reports for all code"
depends = ["coverage:rust", "coverage:frontend"]

[tasks."coverage:rust"]
description = "Generate Rust coverage report"
run = "mkdir -p coverage/rust && cd src-tauri && cargo llvm-cov --all-features --workspace --lcov --output-path ../coverage/rust/lcov.info -- --test-threads=1 && cargo llvm-cov --all-features --workspace --html --output-dir ../coverage/rust -- --test-threads=1"

[tasks."coverage:frontend"]
description = "Generate frontend coverage report"
run = "npm run test:coverage"
